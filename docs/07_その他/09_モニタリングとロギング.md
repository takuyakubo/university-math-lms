# モニタリングとロギング

本ドキュメントでは、大学生向け数学特化型学習管理システム（LMS）のモニタリングとロギングの設定について説明します。

## モニタリング対象

### システムリソース

- CPU使用率: 閾値 80%
- メモリ使用率: 閾値 85%
- ディスク使用率: 閾値 90%
- ネットワークトラフィック: 突発的な増加を検知

### アプリケーション指標

- リクエスト応答時間: 3秒以上は遅延と判断
- エラー率: 5%以上は異常と判断
- アクティブセッション数: ピーク時の90%を超えると警告
- データベース接続数: 最大接続数の80%で警告

### 学習関連指標

- 同時アクセスユーザー数: 特に試験期間や課題締切時
- コンテンツへのアクセス頻度: 教材利用状況の把握
- 数式レンダリング時間: 複雑な数式の処理負荷監視

## モニタリングツール

1. **システムモニタリング**: Prometheus + Grafana
2. **ログ収集・分析**: ELK Stack (Elasticsearch, Logstash, Kibana)
3. **アプリケーションパフォーマンス**: New Relic
4. **アラート通知**: PagerDuty

## ロギング設計

### ログレベル

- ERROR: システムエラーや例外
- WARN: 潜在的な問題の予兆
- INFO: 通常の操作情報
- DEBUG: 開発とトラブルシューティング用（本番環境では無効）

### ログ対象イベント

1. **システムイベント**
   - サーバー起動/停止
   - バックアップ開始/完了
   - バッチジョブ実行

2. **セキュリティイベント**
   - ログイン試行（成功/失敗）
   - 権限変更
   - センシティブデータへのアクセス

3. **学習イベント**
   - コース登録
   - 課題提出
   - テスト完了

### ログフォーマット

```
[TIMESTAMP] [LOG_LEVEL] [REQUEST_ID] [USER_ID] [SOURCE] - Message
```

## アラート設定

### 緊急アラート（即時通知）

- システムクラッシュ
- データベース接続不可
- ディスク空き容量不足（残り5%未満）
- セキュリティインシデント検知

### 警告アラート（営業時間内通知）

- パフォーマンス低下
- エラー率の上昇
- バックアップ失敗
- API応答時間の遅延

## ダッシュボード

### 運用チーム向けダッシュボード

- システム全体の健全性
- リソース使用率推移
- エラー発生率
- バックアップステータス

### 教職員向けダッシュボード

- アクティブユーザー数
- 教材アクセス統計
- 学生の活動パターン
- テスト結果集計

## 監視体制

- 営業時間内: 運用チームによる監視
- 営業時間外: オンコール体制
- 重要イベント時（試験期間など）: 増員体制

## ログ保持ポリシー

- ERROR レベルログ: 2年間
- WARN レベルログ: 1年間
- INFO レベルログ: 6か月
- DEBUG レベルログ: 1週間（テスト環境のみ）
